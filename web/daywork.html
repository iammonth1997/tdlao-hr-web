<!DOCTYPE html>
<html lang="lo">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Day Work</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;600;700;800&family=Noto+Sans+Lao:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="../js/lang.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --red: #cc0000; --dark: #0d1117; --card: #131a24; --border: #1e2a38;
      --text: #ffffff; --muted: #8899aa; --green: #00cc66; --yellow: #ffaa00;
    }
    body { font-family: "Saira","Noto Sans Lao",sans-serif; background: var(--dark); color: var(--text); min-height:100vh; }
    .header {
      background: #000; border-bottom: 3px solid var(--red);
      padding: 16px 20px; display: flex; align-items: center; gap: 12px;
    }
    .back-btn {
      background: var(--border); border: none; color: var(--text);
      width: 36px; height: 36px; border-radius: 10px;
      font-size: 18px; cursor: pointer;
      display: flex; align-items: center; justify-content: center;
    }
    .header h1 { font-size: 18px; font-weight: 700; }

    .content { padding: 20px; }

    .emp-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 14px; padding: 16px 20px;
      margin-bottom: 20px;
    }
    .emp-card .name { font-size: 18px; font-weight: 700; }
    .emp-card .meta { font-size: 13px; color: var(--muted); margin-top: 4px; }

    .stats-grid {
      display: grid; grid-template-columns: 1fr 1fr;
      gap: 12px; margin-bottom: 20px;
    }
    .stat-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 14px; padding: 18px 16px;
      text-align: center;
    }
    .stat-card .icon { font-size: 24px; margin-bottom: 8px; }
    .stat-card .val  { font-size: 28px; font-weight: 800; }
    .stat-card .lbl  { font-size: 12px; color: var(--muted); margin-top: 4px; font-weight: 600; }
    .stat-card.green { border-color: rgba(0,204,102,0.3); }
    .stat-card.green .val { color: var(--green); }
    .stat-card.red   { border-color: rgba(204,0,0,0.3); }
    .stat-card.red .val   { color: #ff4444; }
    .stat-card.yellow { border-color: rgba(255,170,0,0.3); }
    .stat-card.yellow .val { color: var(--yellow); }

    .detail-card {
      background: var(--card); border: 1px solid var(--border);
      border-radius: 14px; overflow: hidden; margin-bottom: 20px;
    }
    .detail-card h3 {
      padding: 14px 20px; font-size: 13px; font-weight: 700;
      color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border);
    }
    .detail-row {
      display: flex; justify-content: space-between; align-items: center;
      padding: 14px 20px; border-bottom: 1px solid var(--border);
    }
    .detail-row:last-child { border-bottom: none; }
    .detail-row .label { font-size: 14px; color: var(--muted); }
    .detail-row .value { font-size: 15px; font-weight: 700; }

    .loading-wrap { text-align: center; padding: 60px 20px; }
    .loading-wrap p { color: var(--muted); margin-top: 12px; }
    .spinner {
      width: 36px; height: 36px; border: 3px solid var(--border);
      border-top-color: var(--red); border-radius: 50%;
      animation: spin 0.8s linear infinite; margin: 0 auto;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .error-wrap {
      text-align: center; padding: 60px 20px;
      display: none;
    }
    .error-wrap .icon { font-size: 40px; }
    .error-wrap p { color: var(--muted); margin-top: 12px; }
  </style>
</head>
<body>

  <div class="header">
    <button class="back-btn" onclick="history.back()">‚Üê</button>
    <h1 data-lang="daywork_title">‡∫ß‡∫±‡∫ô‡ªÄ‡∫Æ‡∫±‡∫î‡∫ß‡∫Ω‡∫Å</h1>
  </div>

  <div class="content">

    <div class="loading-wrap" id="loadingWrap">
      <div class="spinner"></div>
      <p data-lang="loading">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫•‡∫î...</p>
    </div>

    <div class="error-wrap" id="errorWrap">
      <div class="icon">‚ö†Ô∏è</div>
      <p id="errorMsg">‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô</p>
    </div>

    <div id="dataWrap" style="display:none">

      <div class="emp-card">
        <div class="name" id="empName">-</div>
        <div class="meta" id="empMeta">-</div>
      </div>

      <div class="stats-grid">
        <div class="stat-card green">
          <div class="icon">üìÖ</div>
          <div class="val" id="statDays">-</div>
          <div class="lbl" data-lang="workdays">‡∫ß‡∫±‡∫ô‡∫á‡∫≤‡∫ô</div>
        </div>
        <div class="stat-card yellow">
          <div class="icon">‚è∞</div>
          <div class="val" id="statLate">-</div>
          <div class="lbl" data-lang="late">‡∫°‡∫≤‡∫™‡∫≤‡∫ç</div>
        </div>
        <div class="stat-card red">
          <div class="icon">‚ùå</div>
          <div class="val" id="statAbsent">-</div>
          <div class="lbl" data-lang="absent">‡∫Ç‡∫≤‡∫î‡∫ß‡∫Ω‡∫Å</div>
        </div>
        <div class="stat-card">
          <div class="icon">üèñ</div>
          <div class="val" id="statVL">-</div>
          <div class="lbl" data-lang="annual_leave">‡∫•‡∫≤‡∫û‡∫±‡∫Å</div>
        </div>
      </div>

      <div class="detail-card">
        <h3>Detail</h3>
        <div class="detail-row">
          <span class="label" data-lang="annual_leave">‡∫•‡∫≤‡∫û‡∫±‡∫Å‡∫õ‡∫∞‡∫à‡∫≥‡∫õ‡∫µ</span>
          <span class="value" id="detailVL">-</span>
        </div>
        <div class="detail-row">
          <span class="label" data-lang="sick_leave">‡∫•‡∫≤‡ªÄ‡∫à‡∫±‡∫ö‡∫õ‡ªà‡∫ß‡∫ç</span>
          <span class="value" id="detailSL">-</span>
        </div>
        <div class="detail-row">
          <span class="label" data-lang="personal_leave">‡∫•‡∫≤‡∫Å‡∫¥‡∫î</span>
          <span class="value" id="detailPL">-</span>
        </div>
        <div class="detail-row">
          <span class="label">‡∫ß‡∫±‡∫ô‡∫ó‡∫µ‡ªà‡∫ö‡ªç‡ªà‡ªÑ‡∫î‡ªâ‡∫™‡∫∞‡ªÅ‡∫Å‡∫ô</span>
          <span class="value" id="detailNoScan">-</span>
        </div>
      </div>

    </div>
  </div>

  <script src="../js/api.js"></script>
  <script>
    // Auth check
    const token = localStorage.getItem("tdlao_token");
    const empId = localStorage.getItem("tdlao_emp");
    const ts = parseInt(localStorage.getItem("tdlao_ts") || "0", 10);
    const TTL = 30 * 24 * 60 * 60 * 1000;
    if (!token || !empId || !ts || (Date.now() - ts > TTL)) {
      localStorage.removeItem("tdlao_token");
      localStorage.removeItem("tdlao_emp");
      localStorage.removeItem("tdlao_ts");
      window.location.replace("/web/login.html");
    }

    const p     = new URLSearchParams(location.search);
    const month = p.get("month");
    const year  = p.get("year");

    async function loadData() {
      try {
        const data = await callAPI("daywork", { month, year });

        document.getElementById("loadingWrap").style.display = "none";

        if (!data || data.error) {
          document.getElementById("errorWrap").style.display = "block";
          document.getElementById("errorMsg").textContent = data?.error || "‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô";
          return;
        }

        document.getElementById("dataWrap").style.display = "block";

        document.getElementById("empName").textContent    = data.name     || "-";
        document.getElementById("empMeta").textContent    = `${data.position || ""} ¬∑ ${data.department || ""} ¬∑ ${month}/${year}`;
        document.getElementById("statDays").textContent   = data.days     ?? "-";
        document.getElementById("statLate").textContent   = data.late     ?? "-";
        document.getElementById("statAbsent").textContent = data.absent   ?? "-";
        document.getElementById("statVL").textContent     = data.vl       ?? "-";
        document.getElementById("detailVL").textContent   = (data.vl      ?? "-") + " ‡∫ß‡∫±‡∫ô";
        document.getElementById("detailSL").textContent   = (data.sl      ?? "-") + " ‡∫ß‡∫±‡∫ô";
        document.getElementById("detailPL").textContent   = (data.pl      ?? "-") + " ‡∫ß‡∫±‡∫ô";
        document.getElementById("detailNoScan").textContent = (data.no_scan ?? "-") + " ‡∫ß‡∫±‡∫ô";

      } catch (err) {
        document.getElementById("loadingWrap").style.display = "none";
        document.getElementById("errorWrap").style.display   = "block";
        document.getElementById("errorMsg").textContent = err.message;
      }
    }

    loadData();
  </script>
</body>
</html>
