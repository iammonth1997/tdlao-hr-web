<!DOCTYPE html>
<html lang="lo">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OT Hours</title>
  <link href="https://fonts.googleapis.com/css2?family=Saira:wght@400;600;700;800&family=Noto+Sans+Lao:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="../js/lang.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root { --red: #cc0000; --dark: #0d1117; --card: #131a24; --border: #1e2a38; --text: #ffffff; --muted: #8899aa; --orange: #ff6600; }
    body { font-family:"Saira","Noto Sans Lao",sans-serif; background:var(--dark); color:var(--text); min-height:100vh; }
    .header { background:#000; border-bottom:3px solid var(--red); padding:16px 20px; display:flex; align-items:center; gap:12px; }
    .back-btn { background:var(--border); border:none; color:var(--text); width:36px; height:36px; border-radius:10px; font-size:18px; cursor:pointer; display:flex; align-items:center; justify-content:center; }
    .header h1 { font-size:18px; font-weight:700; }
    .content { padding:20px; }
    .emp-card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:16px 20px; margin-bottom:20px; }
    .emp-card .name { font-size:18px; font-weight:700; }
    .emp-card .meta { font-size:13px; color:var(--muted); margin-top:4px; }

    .ot-grid { display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:20px; }
    .ot-card { background:var(--card); border:1px solid var(--border); border-radius:14px; padding:18px 16px; text-align:center; }
    .ot-card .badge { font-size:11px; font-weight:700; background:rgba(255,102,0,0.15); color:var(--orange); padding:3px 10px; border-radius:20px; display:inline-block; margin-bottom:10px; }
    .ot-card .val { font-size:26px; font-weight:800; color:var(--orange); }
    .ot-card .unit { font-size:12px; color:var(--muted); margin-top:2px; }

    .incentive-card {
      background: linear-gradient(135deg, #1a1000, var(--card));
      border: 1px solid rgba(255,170,0,0.3);
      border-radius:14px; padding:20px; text-align:center; margin-bottom:20px;
    }
    .incentive-card .lbl { font-size:13px; color:#ffaa00; font-weight:700; margin-bottom:8px; }
    .incentive-card .val { font-size:28px; font-weight:800; color:#ffcc00; }

    .loading-wrap { text-align:center; padding:60px 20px; }
    .loading-wrap p { color:var(--muted); margin-top:12px; }
    .spinner { width:36px; height:36px; border:3px solid var(--border); border-top-color:var(--red); border-radius:50%; animation:spin 0.8s linear infinite; margin:0 auto; }
    @keyframes spin { to { transform:rotate(360deg); } }
    .error-wrap { text-align:center; padding:60px 20px; display:none; }
    .error-wrap p { color:var(--muted); margin-top:12px; }
  </style>
</head>
<body>
  <div class="header">
    <button class="back-btn" onclick="history.back()">‚Üê</button>
    <h1 data-lang="ot_title">‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á OT</h1>
  </div>

  <div class="content">
    <div class="loading-wrap" id="loadingWrap">
      <div class="spinner"></div>
      <p data-lang="loading">‡∫Å‡∫≥‡∫•‡∫±‡∫á‡ªÇ‡∫´‡∫•‡∫î...</p>
    </div>
    <div class="error-wrap" id="errorWrap">
      <div style="font-size:40px">‚ö†Ô∏è</div>
      <p id="errorMsg">‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô</p>
    </div>

    <div id="dataWrap" style="display:none">
      <div class="emp-card">
        <div class="name" id="empName">-</div>
        <div class="meta" id="empMeta">-</div>
      </div>

      <div class="ot-grid">
        <div class="ot-card">
          <div class="badge">OT 1.5√ó</div>
          <div class="val" id="ot15">-</div>
          <div class="unit">‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á</div>
        </div>
        <div class="ot-card">
          <div class="badge">OT 2.0√ó</div>
          <div class="val" id="ot20">-</div>
          <div class="unit">‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á</div>
        </div>
        <div class="ot-card">
          <div class="badge">OT 2.5√ó</div>
          <div class="val" id="ot25">-</div>
          <div class="unit">‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á</div>
        </div>
        <div class="ot-card">
          <div class="badge">OT 3.0√ó</div>
          <div class="val" id="ot30">-</div>
          <div class="unit">‡∫ä‡∫ª‡ªà‡∫ß‡ªÇ‡∫°‡∫á</div>
        </div>
      </div>

      <div class="incentive-card">
        <div class="lbl">üî• ‡∫Ñ‡ªà‡∫≤‡∫ú‡∫ª‡∫ô‡∫á‡∫≤‡∫ô / Incentive</div>
        <div class="val" id="incentive">-</div>
      </div>
    </div>
  </div>

  <script src="../js/api.js"></script>
  <script>
    const token = localStorage.getItem("tdlao_token");
    const empId = localStorage.getItem("tdlao_emp");
    const ts = parseInt(localStorage.getItem("tdlao_ts") || "0", 10);
    const TTL = 30 * 24 * 60 * 60 * 1000;
    if (!token || !empId || !ts || (Date.now() - ts > TTL)) {
      localStorage.removeItem("tdlao_token");
      localStorage.removeItem("tdlao_emp");
      localStorage.removeItem("tdlao_ts");
      window.location.replace("/web/login.html");
    }

    const p = new URLSearchParams(location.search);
    const month = p.get("month"), year = p.get("year");

    async function loadData() {
      try {
        const data = await callAPI("ot", { month, year });
        document.getElementById("loadingWrap").style.display = "none";

        if (!data || data.error) {
          document.getElementById("errorWrap").style.display = "block";
          document.getElementById("errorMsg").textContent = data?.error || "‡∫ö‡ªç‡ªà‡∫û‡∫ª‡∫ö‡∫Ç‡ªç‡ªâ‡∫°‡∫π‡∫ô";
          return;
        }

        document.getElementById("dataWrap").style.display = "block";
        document.getElementById("empName").textContent = data.name || "-";
        document.getElementById("empMeta").textContent = `${data.position || ""} ¬∑ ${month}/${year}`;
        document.getElementById("ot15").textContent = data.ot15 ?? "-";
        document.getElementById("ot20").textContent = data.ot20 ?? "-";
        document.getElementById("ot25").textContent = data.ot25 ?? "-";
        document.getElementById("ot30").textContent = data.ot30 ?? "-";
        document.getElementById("incentive").textContent =
          data.incentive ? Number(data.incentive).toLocaleString() + " ‡∫Å‡∫µ‡∫ö" : "-";
      } catch (err) {
        document.getElementById("loadingWrap").style.display = "none";
        document.getElementById("errorWrap").style.display = "block";
        document.getElementById("errorMsg").textContent = err.message;
      }
    }
    loadData();
  </script>
</body>
</html>
